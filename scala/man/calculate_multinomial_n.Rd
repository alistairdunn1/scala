% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_multinomial_n.R
\name{calculate_multinomial_n}
\alias{calculate_multinomial_n}
\title{Calculate Multinomial Effective Sample Size}
\usage{
calculate_multinomial_n(
  x,
  stratum = NULL,
  sex = "total",
  remove_outliers = 0.05,
  min_proportion = 1e-04,
  max_cv = 5,
  trace = FALSE
)
}
\arguments{
\item{x}{A length_composition object from calculate_length_compositions()}

\item{stratum}{Character, name of stratum to analyze. If NULL (default), uses pooled data across all strata}

\item{sex}{Character, sex category to analyze: "male", "female", "unsexed", or "total" (default)}

\item{remove_outliers}{Numeric, proportion of outliers to remove (0-1). Default 0.05 removes worst 5 percent of fits}

\item{min_proportion}{Numeric, minimum proportion threshold to include in analysis (default 0.0001)}

\item{max_cv}{Numeric, maximum CV threshold to include in analysis (default 5.0)}

\item{trace}{Logical, whether to show fitting details (default FALSE)}
}
\value{
Named list containing:
  \itemize{
    \item \code{effective_n}: The estimated multinomial effective sample size
    \item \code{proportions}: Vector of proportions used in the analysis
    \item \code{cvs}: Vector of CVs used in the analysis  
    \item \code{n_length_bins}: Number of length bins included in the analysis
    \item \code{fit_summary}: Summary of the nonlinear model fit
  }
}
\description{
Calculates the multinomial effective sample size from length composition proportions and
their coefficients of variation. This provides a measure of the effective sample size
that accounts for the variability in the length composition data.
}
\details{
The function fits a nonlinear model based on the multinomial distribution relationship:
CV = sqrt(n * P * (1 - P)) / (n * P)

where:
- CV is the coefficient of variation
- P is the proportion 
- n is the effective sample size (parameter to be estimated)

Length bins with very small proportions or very large CVs are excluded as they
can unduly influence the fit. An optional outlier removal step can be applied
to improve the robustness of the estimate.
}
\examples{
\dontrun{
test_data <- generate_test_data()
lc_result <- calculate_length_compositions(
  fish_data = test_data$fish_data,
  strata_data = test_data$strata_data,
  length_range = c(20, 40),
  lw_params_male = c(a = 0.01, b = 3.0),
  lw_params_female = c(a = 0.01, b = 3.0), 
  lw_params_unsexed = c(a = 0.01, b = 3.0),
  bootstraps = 100
)

# Calculate effective sample size for total (pooled across strata)
eff_n <- calculate_multinomial_n(lc_result, sex = "total")
print(eff_n$effective_n)

# Calculate for specific stratum and sex
eff_n_male_a <- calculate_multinomial_n(lc_result, stratum = "A", sex = "male")
}

}
\references{
Pennington, M. 1996. Estimating the mean and variance from highly skewed marine data.
Fisheries Bulletin 94: 498-505.
}
\seealso{
\code{\link{calculate_length_compositions}} for generating length composition data,
\code{\link{get_summary}} for summary statistics including CVs
}
